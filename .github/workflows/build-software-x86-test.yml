name: Build DigiLivolo software

on:
  push:
    branches: [ main, dev ]
    tags:
      - "v[0-9]+.[0-9]+.[0-9]+"
  pull_request:
    branches: [ main, dev ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      # Set fail-fast to false to ensure that feedback is delivered for all matrix combinations. Consider changing this to true when your workflow is stable.
      fail-fast: false

    steps:
    - uses: jirutka/setup-alpine@v1
      with:
        branch: v3.15

    - run: cat /etc/alpine-release; uname -a
      shell: alpine.sh {0}

    - name: Install required prerequisite packages on the container and configure git
      run: |
        apt update || yum -y install https://packages.endpointdev.com/rhel/7/os/x86_64/endpoint-repo.x86_64.rpm || echo "WARN: Endpoint repo add failed!"
        apt -y full-upgrade || yum update -y
        apt install -y sudo git dialog python3 python3-pip python3-setuptools curl wget || yum install -y sudo git dialog python3 python3-pip python3-setuptools ninja-build make cmake3 libusb-devel libudev-devel curl wget
        git --version
        git config --global --add safe.directory /__w/dl/dl
        echo
        cat /etc/os-release
      shell: alpine.sh {0}
